<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>강포 전환 계산기</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/png" href="tower3.png">
<style>
body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans KR',sans-serif;background:#f7f7fb;margin:20px}
.card{max-width:900px;margin:0 auto;background:#fff;padding:22px;border-radius:12px;box-shadow:0 10px 30px rgba(20,20,60,0.06)}
h1{margin:0 0 8px;font-size:20px}
label{display:block;margin-top:12px;font-weight:600;color:#222}
input{width:100%;padding:8px 10px;margin-top:6px;border-radius:8px;border:1px solid #ddd;box-sizing:border-box}
input, button {width: 100%; box-sizing: border-box;}
button {
  margin-top: 18px;
  padding: 10px 12px;
  border-radius: 12px;
  border: 0;
  background: #2f6bf6;
  color: #fff;
  font-size: 15px;
  cursor: pointer;
  transition: 0.2s background;
}
button:hover { background: #2551c9; }
.stats{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
.stat{background:#fff;padding:10px;border-radius:8px;border:1px solid #e6eefc;min-width:140px;text-align:center}
.percentBig{font-weight:800;font-size:20px;color:#2f6bf6}
.debugSmall{font-size:12px;color:#555;margin-top:8px}
.title-container { display:flex; align-items:center; justify-content:center; gap:10px; margin-bottom:20px; }
.title-container h1 { font-size:26px; margin:0; color:#1a1a1a; }
.title-container img { width:32px; height:32px; }
</style>
</head>
<body>
<div class="card">
  <div class="title-container">
    <img src="tower3.png" alt="아이콘">
    <h1>★6 → ★8 강포 전환률</h1>
  </div>

  <label>강화 수치 (5~20)
    <input id="levelInput" type="number" min="5" max="20" value="15">
  </label>

  <label>강화 포인트 (0~100)
    <input id="pointInput" type="number" min="0" max="100" step="0.01" value="37.5">
  </label>

  <button id="calcBtn">계산</button>

  <div class="stats" id="statsRow"></div>

  <div style="margin-top:12px">
    <strong>추가</strong>
    <div class="debugSmall" id="explain">
      구간 내부/초과 상태를 기준으로 displayPercent를 안정적으로 계산합니다.
    </div>
  </div>
</div>

<script>
const chart = {
 6: [75,182,323,512,765,1107,1560,2166,2976,4091,6318,9928,17928,34848,75081,212581,453281,762681,1175181,2000281],
 8: [169,410,727,1152,1721,2491,3510,4874,6696,9205,14216,22338,40338,78408,168932,478307,1019882,1716032,2644157,4500632]
};

const enhanceRateTable = {
 5:80,6:70,7:60,8:50,9:40,10:30,11:15,12:10,13:7,14:5,15:3
};

function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

function compute(level, point){
  level = Math.floor(level);
  point = parseFloat(point);

  const baseIndex6 = clamp(level - 1, 0, chart[6].length - 1);
  const nextIndex6 = Math.min(level, chart[6].length - 1);

  const base6 = chart[6][baseIndex6];
  const next6 = chart[6][nextIndex6];
  const diff6 = next6 - base6;
  const consumed = base6 + diff6 * (point / 100);

  let surpassedLevel = 0;
  for (let idx = chart[8].length - 1; idx >= 0; idx--){
    if (consumed >= chart[8][idx]) { surpassedLevel = idx + 1; break; }
  }

  let prevIndex8 = clamp(surpassedLevel - 1, 0, chart[8].length - 1);
  let prevValue = (surpassedLevel === 0) ? 0 : chart[8][prevIndex8];
  let nextValue = (surpassedLevel < chart[8].length) ? chart[8][surpassedLevel] : chart[8][chart[8].length-1];

  let relativePercent = (nextValue > prevValue) ? ((consumed - prevValue) / (nextValue - prevValue)) * 100 : (consumed >= prevValue ? 100:0);
  let absolutePercent = (nextValue > 0) ? (consumed / nextValue) * 100 : 0;
  let displayPercent = relativePercent;

  const prevBreakPointPct = (diff6 !== 0) ? ((prevValue - base6) / diff6) * 100 : NaN;
  const nextBreakPointPct = (diff6 !== 0) ? ((nextValue - base6) / diff6) * 100 : NaN;

  return {level, point, base6, next6, diff6, consumed, surpassedLevel, prevIndex8, prevValue, nextValue, relativePercent, absolutePercent, displayPercent, prevBreakPointPct, nextBreakPointPct};
}

function formatNum(n,d=2){ return isFinite(n)?n.toFixed(d):String(n); }

function renderResult(obj){
  const statsRow = document.getElementById('statsRow');
  statsRow.innerHTML = '';

  function pushStat(title,valHtml){
    const d = document.createElement('div');
    d.className = 'stat';
    d.innerHTML = `<div style="font-size:12px;color:#666">${title}</div><div style="margin-top:6px">${valHtml}</div>`;
    statsRow.appendChild(d);
  }

  pushStat('예상 수치', `<div class="percentBig">${obj.surpassedLevel}강</div>`);
  pushStat('표시 퍼센트', `<div class="percentBig">${formatNum(clamp(obj.displayPercent,0,100),2)}%</div>`);

// 다음 강화 기대값 계산 (단순화)
const nextLevel = obj.surpassedLevel+1;
const successRatePct = enhanceRateTable[nextLevel] !== undefined ? enhanceRateTable[nextLevel] : 1; // %
const successRate = successRatePct / 100; // 0~1
const failPoint = successRate / 2;        // 실패 시 적립 (0~1 단위)

const expectVal = successRate + failPoint;            // 1회당 기대값
const remainPercent = 100 - obj.displayPercent;      // 남은 퍼센트

// 평균 시도 = 남은 퍼센트 ÷ 1회 기대값
const avgTries = Math.ceil(remainPercent / (expectVal * 100)); // 소수점 제거

pushStat('다음 강화 기대횟수', `${avgTries}회`);
pushStat('1회당 기대값', `${formatNum(expectVal*100,2)}%`);

  

  document.getElementById('explain').innerText = '실제 누적 포인트 기준 평균 시도 계산 적용';
}

document.getElementById('calcBtn').addEventListener('click', ()=>{
  const level = Number(document.getElementById('levelInput').value);
  const point = Number(document.getElementById('pointInput').value);
  renderResult(compute(level, point));
});
</script>
</body>
</html>
